<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact - Mon Portfolio</title>
    <link rel="stylesheet" href="../style.css" />
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <div class="logo"><a href="../index.html">Mon Portfolio</a></div>
            <ul class="nav-links" id="navLinks">
                <li><a href="../index.html" data-i18n="nav.home">Accueil</a></li>
                <li><a href="../index.html#apropos" data-i18n="nav.about">√Ä propos</a></li>
                <li><a href="../formation/formation.html" data-i18n="nav.path">Parcours et Exp√©riences</a></li>
                <li><a href="../projets/projets.html" data-i18n="nav.projects">Projets</a></li>
                <li><a href="../forum/forum.html" data-i18n="nav.articles">Articles</a></li>
                <li><a href="./optimization/optimization.html" data-i18n="nav.optimization">Optimisation PC</a></li>
                <li><a href="#" data-i18n="nav.contact">Contact</a></li>
                <button class="lang-toggle" id="languageToggle" aria-label="Changer de langue">üá´üá∑ FR</button>
                <button class="theme-toggle" id="themeToggle" aria-label="Changer de th√®me">
                    <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
                <button class="font-toggle" id="fontToggle" aria-label="Changer de police">Aa</button>
            </ul>
            <div class="menu-toggle" id="menuToggle">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
        </div>
    </nav>

    <!-- Side Menu -->
    <div class="side-menu" id="sideMenu">
        <ul class="side-nav-links">
            <li><a href="../index.html" data-i18n="nav.home">Accueil</a></li>
            <li><a href="../index.html#apropos" data-i18n="nav.about">√Ä propos</a></li>
            <li><a href="../formation/formation.html" data-i18n="nav.journey">Parcours et Exp√©riences</a></li>
            <li><a href="../projets/projets.html" data-i18n="nav.projects">Projets</a></li>
            <li><a href="../forum/forum.html" data-i18n="nav.articles">Articles</a></li>
            <li><a href="../optimization/optimization.html" data-i18n="nav.optimization">Optimisation PC</a></li>
            <li><a href="#" data-i18n="nav.contact">Contact</a></li>
        </ul>
        <div class="side-menu-toggles">
            <button class="lang-toggle" id="languageToggleMobile" aria-label="Changer de langue">EN</button>
            <button class="theme-toggle" id="themeToggleMobile" aria-label="Changer de th√®me">
                <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
                <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
            <button class="font-toggle" id="fontToggleMobile" aria-label="Changer de police">Aa</button>
        </div>
    </div>

    <!-- Contact Section -->
    <section id="contact" class="contact-section">
        <div class="container">
            <h1 class="section-title" data-i18n="contact.title">Contactez-moi</h1>
            <p class="section-subtitle" data-i18n="contact.subtitle">Une question ? Un projet ? N'h√©sitez pas √† me contacter !</p>
            <div class="contact-grid">
                <!-- Formulaire de contact -->
                <div class="contact-form-container">
                    <h3 data-i18n="contact.form.title">üì® Envoyez-moi un message</h3>
                    <!-- Message de succ√®s/erreur -->
                    <div class="message success" id="successMessage" data-i18n="contact.form.success">
                        ‚úÖ Message envoy√© avec succ√®s ! Je vous r√©pondrai rapidement.
                    </div>
                    <div class="message error" id="errorMessage" data-i18n="contact.form.error">
                        ‚ùå Une erreur s'est produite. Veuillez r√©essayer.
                    </div>
                    <form id="contactForm">
                        <div class="form-group">
                            <label for="name" data-i18n="contact.form.name.label">Nom complet *</label>
                            <input type="text" id="name" name="name" placeholder="Votre nom" data-i18n-placeholder="contact.form.name.ph" required>
                        </div>
                        <div class="form-group">
                            <label for="email" data-i18n="contact.form.email.label">Email *</label>
                            <input type="email" id="email" name="email" placeholder="votre@email.com" data-i18n-placeholder="contact.form.email.ph" required>
                        </div>
                        <div class="form-group">
                            <label for="subject" data-i18n="contact.form.subject.label">Sujet *</label>
                            <input type="text" id="subject" name="subject" placeholder="Sujet de votre message" data-i18n-placeholder="contact.form.subject.ph" required>
                        </div>
                        <div class="form-group">
                            <label for="message" data-i18n="contact.form.message.label">Message *</label>
                            <textarea id="message" name="message" placeholder="Votre message..." data-i18n-placeholder="contact.form.message.ph" required></textarea>
                        </div>
                        <!-- Honeypot (anti-bot invisible) -->
                        <div style="display:none;">
                            <input type="text" name="honeypot" id="honeypot" tabindex="-1" autocomplete="off">
                        </div>
                        <button type="submit" class="submit-btn" id="submitBtn" data-i18n="contact.form.submit">
                            <span>Envoyer le message</span>
                            <span>‚úâÔ∏è</span>
                        </button>
                    </form>
                </div>
                <!-- Informations de contact -->
                <div class="contact-info-container">
                    <!-- Coordonn√©es -->
                    <div class="contact-info-card">
                        <h4 data-i18n="contact.info.title">üìû Mes coordonn√©es</h4>
                        <div class="contact-item">
                            <div class="contact-icon">üìß</div>
                            <div class="contact-item-content">
                                <div class="contact-item-label" data-i18n="contact.info.email">Email</div>
                                <div class="contact-item-value">
                                    <a href="mailto:benbenjamin3005@gmail.com">benbenjamin3005@gmail.com</a>
                                </div>
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-icon">üì±</div>
                            <div class="contact-item-content">
                                <div class="contact-item-label" data-i18n="contact.info.phone">T√©l√©phone</div>
                                <div class="contact-item-value">
                                    <a href="tel:+33766739614">+33 7 66 73 96 14</a>
                                </div>
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-icon">üìç</div>
                            <div class="contact-item-content">
                                <div class="contact-item-label" data-i18n="contact.info.location">Localisation</div>
                                <div class="contact-item-value" data-i18n="contact.info.location.value">Auberchicourt, Nord</div>
                            </div>
                        </div>
                    </div>
                    <!-- R√©seaux sociaux -->
                    <div class="contact-info-card">
                        <h4 data-i18n="contact.social.title">üåê R√©seaux sociaux</h4>
                        <div class="social-links">
                            <a href="https://www.linkedin.com/in/benjamin-blondiaux-948894317" target="_blank" class="social-btn">
                                <span>üíº</span>
                                <span>LinkedIn</span>
                            </a>
                            <a href="https://github.com/BENJGabber" target="_blank" class="social-btn">
                                <span>üíª</span>
                                <span>GitHub</span>
                            </a>
                        </div>
                    </div>
                    <!-- T√©l√©charger CV -->
                    <div class="download-cv">
                        <h4 data-i18n="contact.cv.title">üìÑ Mon CV</h4>
                        <p data-i18n="contact.cv.desc">T√©l√©chargez mon CV complet au format PDF</p>
                        <a href="./CV.pdf" class="cv-btn" download>
                            <span>‚¨áÔ∏è</span>
                            <span data-i18n="contact.cv.button">T√©l√©charger mon CV</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <script>
    // Simple initialization
        emailjs.init('hJ21pqCbKdeCOCaZD');

    // === Fingerprinting hardcore pour limiter par "appareil" ===
        function getFingerprint() {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        ctx.textBaseline = 'top';
        ctx.font = '14px Arial';
        ctx.fillStyle = '#f60';
        ctx.fillRect(125, 1, 62, 20);
        ctx.fillStyle = '#069';
        ctx.fillText('browser fingerprint üòà', 2, 15);
        const canvasData = canvas.toDataURL();

        const data = [
            navigator.userAgent,
            navigator.language || navigator.userLanguage,
            screen.width + 'x' + screen.height + 'x' + screen.colorDepth,
            new Date().getTimezoneOffset(),
            !!window.sessionStorage,
            !!window.indexedDB,
            navigator.hardwareConcurrency || 'unknown',
            canvasData.substring(canvasData.length - 100)
        ];

        return btoa(data.join('|||'));
    }

    // === Check cooldown 10 minutes par fingerprint ===
    function canSendMessage() {
        const fp = getFingerprint();
        const key = 'lastMessage_' + fp;
        const lastSend = localStorage.getItem(key);

        if (!lastSend) return true;

        const now = Date.now();
        const timeSinceLast = now - parseInt(lastSend);
        const cooldown = 10 * 60 * 1000; // 10 minutes

        if (timeSinceLast < cooldown) {
            const minutesLeft = Math.ceil((cooldown - timeSinceLast) / 60000);
            errorMessage.textContent = `T'as d√©j√† envoy√© un message avec cet appareil. Attends ${minutesLeft} minute${minutesLeft > 1 ? 's' : ''}, spammer. üòà`;
            errorMessage.classList.add('show');
            setTimeout(() => errorMessage.classList.remove('show'), 8000);
            return false;
        }
        return true;
    }

    const contactForm = document.getElementById('contactForm');
    const submitBtn = document.getElementById('submitBtn');
    const successMessage = document.getElementById('successMessage');
    const errorMessage = document.getElementById('errorMessage');
    const EMAIL_SERVICE_ID = 'service_7n8wk97';
    const TEMPLATE_RECEPTION_ID = 'template_lpd0e4d';
    const TEMPLATE_AUTOREPLY_ID = 'template_44urjvt';

    contactForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        // 1. Honeypot
        if (document.getElementById('honeypot').value !== '') {
            errorMessage.textContent = "Spam d√©tect√©. D√©gage.";
            errorMessage.classList.add('show');
            setTimeout(() => errorMessage.classList.remove('show'), 5000);
            return;
        }

        // 2. Fingerprint + cooldown 10 min
        if (!canSendMessage()) {
            return;
        }

        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span>Envoi en cours...</span><span>‚è≥</span>';
        successMessage.classList.remove('show');
        errorMessage.classList.remove('show');

        // FIXED: Don't send g-recaptcha-response to EmailJS
        const formData = {
            name: document.getElementById('name').value,
            email: document.getElementById('email').value,
            title: document.getElementById('subject').value,
            message: document.getElementById('message').value
            // REMOVED: 'g-recaptcha-response': recaptchaResponse
        };

        try {
            // Send both emails
            await emailjs.send(EMAIL_SERVICE_ID, TEMPLATE_RECEPTION_ID, formData);
            await emailjs.send(EMAIL_SERVICE_ID, TEMPLATE_AUTOREPLY_ID, {
                name: formData.name,
                email: formData.email,
                title: formData.title,
                message: formData.message
            });

            // === Enregistrement du fingerprint apr√®s succ√®s ===
            const fp = getFingerprint();
            localStorage.setItem('lastMessage_' + fp, Date.now().toString());

            successMessage.classList.add('show');
            contactForm.reset();
            setTimeout(() => successMessage.classList.remove('show'), 5000);
        } catch (error) {
            console.error('Erreur EmailJS:', error);
            if (error.text && error.text.includes('rate limit')) {
                errorMessage.textContent = "Trop rapide, calme-toi 15 secondes.";
            } else {
                errorMessage.textContent = "√âchec. R√©essaie plus tard.";
            }
            errorMessage.classList.add('show');
            setTimeout(() => errorMessage.classList.remove('show'), 5000);
        } finally {
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<span>Envoyer le message</span><span>‚úâÔ∏è</span>';
        }
    });
</script>

    <!-- Bouton Retour en haut -->
    <button id="backToTop" class="back-to-top" data-i18n-aria="back.toTop" aria-label="Retour en haut">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="18 15 12 9 6 15"></polyline>
        </svg>
        <span class="sr-only" data-i18n="back.toTop">Retour en haut</span>
    </button>
    <script src="../script.js"></script>
</body>
</html>
