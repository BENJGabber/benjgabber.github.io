<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Contact - Mon Portfolio</title>
    <link rel="stylesheet" href="../style.css" />
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <div class="logo"><a href="../index.html">Mon Portfolio</a></div>
            <ul class="nav-links" id="navLinks">
                <li><a href="../index.html" data-i18n="nav.home">Accueil</a></li>
                <li><a href="../index.html#apropos" data-i18n="nav.about">√Ä propos</a></li>
                <li><a href="../formation/formation.html" data-i18n="nav.path">Parcours et Exp√©riences</a></li>
                <li><a href="../projets/projets.html" data-i18n="nav.projects">Projets</a></li>
                <li><a href="../forum/forum.html" data-i18n="nav.articles">Articles</a></li>
                <li><a href="../cisco/cisco.html" data-i18n="nav.cisco">Tutoriels Cisco</a></li>
                <li><a href="../optimization/optimization.html" data-i18n="nav.optimization">Optimisation PC</a></li>
                <li><a href="../resources/resources.html" data-i18n="nav.resources">Ressources</a></li>
                <li><a href="#" data-i18n="nav.contact">Contact</a></li>
                <button class="lang-toggle" id="languageToggle" aria-label="Changer de langue">üá´üá∑ FR</button>
                <button class="theme-toggle" id="themeToggle" aria-label="Changer de th√®me">
                    <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
                <button class="font-toggle" id="fontToggle" aria-label="Changer de police">Aa</button>
            </ul>
            <div class="menu-toggle" id="menuToggle">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
        </div>
    </nav>

    <!-- Side Menu -->
    <div class="side-menu" id="sideMenu">
        <ul class="side-nav-links">
            <li><a href="../index.html" data-i18n="nav.home">Accueil</a></li>
            <li><a href="../index.html#apropos" data-i18n="nav.about">√Ä propos</a></li>
            <li><a href="../formation/formation.html" data-i18n="nav.journey">Parcours et Exp√©riences</a></li>
            <li><a href="../projets/projets.html" data-i18n="nav.projects">Projets</a></li>
            <li><a href="../forum/forum.html" data-i18n="nav.articles">Articles</a></li>
            <li><a href="../optimization/optimization.html" data-i18n="nav.optimization">Optimisation PC</a></li>
            <li><a href="../resources/resources.html" data-i18n="nav.resources">Ressources</a></li>
            <li><a href="#" data-i18n="nav.contact">Contact</a></li>
        </ul>
        <div class="side-menu-toggles">
            <button class="lang-toggle" id="languageToggleMobile" aria-label="Changer de langue">EN</button>
            <button class="theme-toggle" id="themeToggleMobile" aria-label="Changer de th√®me">
                <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
                <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
            <button class="font-toggle" id="fontToggleMobile" aria-label="Changer de police">Aa</button>
        </div>
    </div>

    <!-- Contact Section -->
    <section id="contact" class="contact-section">
        <div class="container">
            <h1 class="section-title" data-i18n="contact.title">Contactez-moi</h1>
            <p class="section-subtitle" data-i18n="contact.subtitle">Une question ? Un projet ? N'h√©sitez pas √† me contacter !</p>
            <div class="contact-grid">
                <!-- Formulaire de contact -->
                <div class="contact-form-container">
                    <h3 data-i18n="contact.form.title">üì® Envoyez-moi un message</h3>
                    <!-- Message de succ√®s/erreur -->
                    <div class="message success" id="successMessage" data-i18n="contact.form.success">
                        ‚úÖ Message envoy√© avec succ√®s ! Je vous r√©pondrai rapidement.
                    </div>
                    <div class="message error" id="errorMessage" data-i18n="contact.form.error">
                        ‚ùå Une erreur s'est produite. Veuillez r√©essayer.
                    </div>
                    <form id="contactForm">
                        <div class="form-group">
                            <label for="name" data-i18n="contact.form.name.label">Nom complet *</label>
                            <input type="text" id="name" name="name" placeholder="Votre nom" data-i18n-placeholder="contact.form.name.ph" required>
                        </div>
                        <div class="form-group">
                            <label for="email" data-i18n="contact.form.email.label">Email *</label>
                            <input type="email" id="email" name="email" placeholder="votre@email.com" data-i18n-placeholder="contact.form.email.ph" required>
                        </div>
                        <div class="form-group">
                            <label for="subject" data-i18n="contact.form.subject.label">Sujet *</label>
                            <input type="text" id="subject" name="subject" placeholder="Sujet de votre message" data-i18n-placeholder="contact.form.subject.ph" required>
                        </div>
                        <div class="form-group">
                            <label for="message" data-i18n="contact.form.message.label">Message *</label>
                            <textarea id="message" name="message" placeholder="Votre message..." data-i18n-placeholder="contact.form.message.ph" required></textarea>
                        </div>
                        <!-- Honeypot (anti-bot invisible) -->
                        <div style="display:none;">
                            <input type="text" name="honeypot" id="honeypot" tabindex="-1" autocomplete="off">
                        </div>
                        <button type="submit" class="submit-btn" id="submitBtn" data-i18n="contact.form.submit">
                            <span>Envoyer le message</span>
                            <span>‚úâÔ∏è</span>
                        </button>
                    </form>
                </div>
                <!-- Informations de contact -->
                <div class="contact-info-container">
                    <!-- Coordonn√©es -->
                    <div class="contact-info-card">
                        <h4 data-i18n="contact.info.title">üìû Mes coordonn√©es</h4>
                        <div class="contact-item">
                            <div class="contact-icon">üìß</div>
                            <div class="contact-item-content">
                                <div class="contact-item-label" data-i18n="contact.info.email">Email</div>
                                <div class="contact-item-value">
                                    <a href="mailto:benbenjamin3005@gmail.com">benbenjamin3005@gmail.com</a>
                                </div>
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-icon">üì±</div>
                            <div class="contact-item-content">
                                <div class="contact-item-label" data-i18n="contact.info.phone">T√©l√©phone</div>
                                <div class="contact-item-value">
                                    <a href="tel:+33766739614">+33 7 66 73 96 14</a>
                                </div>
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-icon">üìç</div>
                            <div class="contact-item-content">
                                <div class="contact-item-label" data-i18n="contact.info.location">Localisation</div>
                                <div class="contact-item-value" data-i18n="contact.info.location.value">Auberchicourt, Nord</div>
                            </div>
                        </div>
                    </div>
                    <!-- R√©seaux sociaux -->
                    <div class="contact-info-card">
                        <h4 data-i18n="contact.social.title">üåê R√©seaux sociaux</h4>
                        <div class="social-links">
                            <a href="https://www.linkedin.com/in/benjamin-blondiaux-948894317" target="_blank" class="social-btn">
                                <span>üíº</span>
                                <span>LinkedIn</span>
                            </a>
                            <a href="https://github.com/BENJGabber" target="_blank" class="social-btn">
                                <span>üíª</span>
                                <span>GitHub</span>
                            </a>
                        </div>
                    </div>
                    <!-- T√©l√©charger CV -->
                    <div class="download-cv">
                        <h4 data-i18n="contact.cv.title">üìÑ Mon CV</h4>
                        <p data-i18n="contact.cv.desc">T√©l√©chargez mon CV complet au format PDF</p>
                        <a href="./CV.pdf" class="cv-btn" download>
                            <span>‚¨áÔ∏è</span>
                            <span data-i18n="contact.cv.button">T√©l√©charger mon CV</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <script>
    // Simple initialization
        emailjs.init('hJ21pqCbKdeCOCaZD');

    // Get DOM elements first
    const contactForm = document.getElementById('contactForm');
    const submitBtn = document.getElementById('submitBtn');
    const successMessage = document.getElementById('successMessage');
    const errorMessage = document.getElementById('errorMessage');

    // ===== SUPER FINGERPRINTING MULTI-COUCHES =====
    async function getSuperFingerprint() {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        ctx.textBaseline = 'top';
        ctx.font = '14px Arial';
        ctx.fillStyle = '#f60';
        ctx.fillRect(125, 1, 62, 20);
        ctx.fillStyle = '#069';
        ctx.fillText('anti-spam fingerprint', 2, 15);
        const canvasData = canvas.toDataURL();

        // Audio fingerprinting
        let audioHash = 'none';
        try {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioCtx.createOscillator();
            const analyser = audioCtx.createAnalyser();
            const gainNode = audioCtx.createGain();
            const scriptProcessor = audioCtx.createScriptProcessor(4096, 1, 1);
            
            gainNode.gain.value = 0;
            oscillator.connect(analyser);
            analyser.connect(scriptProcessor);
            scriptProcessor.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            scriptProcessor.onaudioprocess = function(bins) {
                const output = bins.outputBuffer.getChannelData(0);
                audioHash = output.slice(0, 30).join('');
            };
            
            oscillator.start(0);
            await new Promise(resolve => setTimeout(resolve, 100));
            oscillator.stop();
            audioCtx.close();
        } catch(e) {
            audioHash = 'error';
        }

        // WebGL fingerprinting
        let webglHash = 'none';
        try {
            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
            webglHash = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
        } catch(e) {
            webglHash = 'error';
        }

        // Fonts detection
        const fonts = ['monospace', 'sans-serif', 'serif'];
        const testString = 'mmmmmmmmmmlli';
        const testSize = '72px';
        const h = document.getElementsByTagName('body')[0];
        const s = document.createElement('span');
        s.style.fontSize = testSize;
        s.innerHTML = testString;
        const defaultWidth = {};
        const defaultHeight = {};
        
        for (const font of fonts) {
            s.style.fontFamily = font;
            h.appendChild(s);
            defaultWidth[font] = s.offsetWidth;
            defaultHeight[font] = s.offsetHeight;
            h.removeChild(s);
        }
        
        const fontList = ['Arial', 'Verdana', 'Times New Roman', 'Courier New'];
        const fontsDetected = fontList.filter(font => {
            for (const baseFont of fonts) {
                s.style.fontFamily = `${font},${baseFont}`;
                h.appendChild(s);
                const matched = s.offsetWidth !== defaultWidth[baseFont] || 
                               s.offsetHeight !== defaultHeight[baseFont];
                h.removeChild(s);
                if (matched) return true;
            }
            return false;
        });

        const data = [
            navigator.userAgent,
            navigator.language || navigator.userLanguage,
            screen.width + 'x' + screen.height + 'x' + screen.colorDepth,
            screen.availWidth + 'x' + screen.availHeight,
            new Date().getTimezoneOffset(),
            !!window.sessionStorage,
            !!window.localStorage,
            !!window.indexedDB,
            typeof(window.openDatabase),
            navigator.cpuClass || 'unknown',
            navigator.platform || 'unknown',
            navigator.hardwareConcurrency || 'unknown',
            navigator.deviceMemory || 'unknown',
            navigator.maxTouchPoints || 0,
            !!window.ActiveXObject || "ActiveXObject" in window,
            canvasData.substring(canvasData.length - 100),
            audioHash.substring(0, 50),
            webglHash,
            fontsDetected.join(','),
            navigator.plugins.length,
            navigator.languages ? navigator.languages.join(',') : ''
        ];

        const fingerprint = btoa(data.join('|||'));
        
        // Hash suppl√©mentaire avec crypto
        const encoder = new TextEncoder();
        const dataBuffer = encoder.encode(fingerprint);
        const hashBuffer = await crypto.subtle.digest('SHA-256', dataBuffer);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        
        return hashHex;
    }

    // ===== SYST√àME DE POINTS DE SUSPICION =====
    let suspicionScore = 0;
    const MAX_SUSPICION = 100;

    function addSuspicion(points, reason) {
        suspicionScore += points;
        console.log(`‚ö†Ô∏è +${points} suspicion: ${reason} (Total: ${suspicionScore})`);
        
        if (suspicionScore >= MAX_SUSPICION) {
            lockoutUser('Score de suspicion trop √©lev√©');
            return true;
        }
        return false;
    }

    // D√©tecter comportement bot
    let mouseMovements = 0;
    let keyPresses = 0;
    let formFocusTime = 0;
    let lastInteraction = Date.now();

    document.addEventListener('mousemove', () => {
        mouseMovements++;
        lastInteraction = Date.now();
    });

    document.addEventListener('keydown', () => {
        keyPresses++;
        lastInteraction = Date.now();
    });

    contactForm.addEventListener('focus', () => {
        formFocusTime = Date.now();
    }, true);

    // ===== LOCKOUT SYSTEM =====
    function lockoutUser(reason) {
        const lockoutKey = 'contact_lockout';
        const lockoutData = {
            until: Date.now() + (24 * 60 * 60 * 1000), // 24h
            reason: reason
        };
        localStorage.setItem(lockoutKey, JSON.stringify(lockoutData));
        
        showToast(`üö´ Acc√®s bloqu√© pour 24h. Raison: ${reason}`, 'error', 6000);
        submitBtn.disabled = true;
        contactForm.style.opacity = '0.5';
        contactForm.style.pointerEvents = 'none';
    }

    function checkLockout() {
        const lockoutKey = 'contact_lockout';
        const lockoutData = localStorage.getItem(lockoutKey);
        
        if (lockoutData) {
            try {
                const data = JSON.parse(lockoutData);
                if (Date.now() < data.until) {
                    const hoursLeft = Math.ceil((data.until - Date.now()) / (60 * 60 * 1000));
                    lockoutUser(`${data.reason} (${hoursLeft}h restantes)`);
                    return true;
                } else {
                    localStorage.removeItem(lockoutKey);
                }
            } catch(e) {
                localStorage.removeItem(lockoutKey);
            }
        }
        return false;
    }

    // ===== RATE LIMITING MULTI-NIVEAUX =====
    async function canSendMessage() {
        // Check lockout first
        if (checkLockout()) return false;

        const fp = await getSuperFingerprint();
        const key = 'lastMessage_' + fp;
        const countKey = 'messageCount_' + fp;
        const attemptsKey = 'failedAttempts_' + fp;
        
        const lastSend = localStorage.getItem(key);
        const messageCount = parseInt(localStorage.getItem(countKey) || '0');
        const failedAttempts = parseInt(localStorage.getItem(attemptsKey) || '0');

        // Trop de tentatives √©chou√©es = lockout
        if (failedAttempts >= 5) {
            lockoutUser('Trop de tentatives suspectes');
            return false;
        }

        // Trop de messages envoy√©s = lockout
        if (messageCount >= 3) {
            lockoutUser('Limite de messages atteinte');
            return false;
        }

        if (!lastSend) return true;

        const now = Date.now();
        const timeSinceLast = now - parseInt(lastSend);
        
        // Cooldown progressif
        const baseCooldown = 10 * 60 * 1000; // 10 minutes
        const cooldown = baseCooldown * (messageCount + 1);

        if (timeSinceLast < cooldown) {
            const minutesLeft = Math.ceil((cooldown - timeSinceLast) / 60000);
            localStorage.setItem(attemptsKey, (failedAttempts + 1).toString());
            showToast(`‚è≥ Cooldown actif: ${minutesLeft} minutes restantes`, 'info', 8000);
            
            if (addSuspicion(20, 'Tentative pendant cooldown')) return false;
            return false;
        }
        return true;
    }

    const EMAIL_SERVICE_ID = 'service_7n8wk97';
    const TEMPLATE_RECEPTION_ID = 'template_lpd0e4d';
    const TEMPLATE_AUTOREPLY_ID = 'template_44urjvt';

    contactForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        // 1. Honeypot
        if (document.getElementById('honeypot').value !== '') {
            errorMessage.textContent = "Spam d√©tect√©. D√©gage.";
            errorMessage.classList.add('show');
            setTimeout(() => errorMessage.classList.remove('show'), 5000);
            return;
        }

        // 2. Fingerprint + rate limiting multi-niveaux
        if (!await canSendMessage()) {
            return;
        }

        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span>Envoi en cours...</span><span>‚è≥</span>';

        const formData = {
            name: document.getElementById('name').value,
            email: document.getElementById('email').value,
            title: document.getElementById('subject').value,
            message: document.getElementById('message').value
        };

        try {
            // Send both emails
            await emailjs.send(EMAIL_SERVICE_ID, TEMPLATE_RECEPTION_ID, formData);
            await emailjs.send(EMAIL_SERVICE_ID, TEMPLATE_AUTOREPLY_ID, {
                name: formData.name,
                email: formData.email,
                title: formData.title,
                message: formData.message
            });

            // === Enregistrement du fingerprint apr√®s succ√®s ===
            const fp = await getSuperFingerprint();
            const countKey = 'messageCount_' + fp;
            const currentCount = parseInt(localStorage.getItem(countKey) || '0');
            localStorage.setItem('lastMessage_' + fp, Date.now().toString());
            localStorage.setItem(countKey, (currentCount + 1).toString());
            localStorage.removeItem('failedAttempts_' + fp);

            showToast('‚úÖ Message envoy√© avec succ√®s ! Je vous r√©pondrai rapidement.', 'success', 5000);
            contactForm.reset();
        } catch (error) {
            console.error('Erreur EmailJS:', error);
            const fp = await getSuperFingerprint();
            const attemptsKey = 'failedAttempts_' + fp;
            const failedAttempts = parseInt(localStorage.getItem(attemptsKey) || '0');
            localStorage.setItem(attemptsKey, (failedAttempts + 1).toString());
            
            let errorMsg = "‚ùå Une erreur s'est produite. Veuillez r√©essayer.";
            if (error.text && error.text.includes('rate limit')) {
                errorMsg = "‚è±Ô∏è Trop rapide, calme-toi 15 secondes.";
            }
            showToast(errorMsg, 'error', 5000);
        } finally {
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<span>Envoyer le message</span><span>‚úâÔ∏è</span>';
        }
    });

</script>

    <!-- Bouton Retour en haut -->
    <button id="backToTop" class="back-to-top" data-i18n-aria="back.toTop" aria-label="Retour en haut">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="18 15 12 9 6 15"></polyline>
        </svg>
        <span class="sr-only" data-i18n="back.toTop">Retour en haut</span>
    </button>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>
    
    <script src="../script.js"></script>
</body>
</html>
