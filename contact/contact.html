<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact - Mon Portfolio</title>
    <link rel="stylesheet" href="../style.css" />
    <!-- reCAPTCHA script -->
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <div class="logo"><a href="../index.html">Mon Portfolio</a></div>
            <ul class="nav-links" id="navLinks">
                <li><a href="../index.html" data-i18n="nav.home">Accueil</a></li>
                <li><a href="../index.html#apropos" data-i18n="nav.about">√Ä propos</a></li>
                <li><a href="../formation/formation.html" data-i18n="nav.path">Parcours et Experiences</a></li>
                <li><a href="../projets/projets.html" data-i18n="nav.projects">Projets</a></li>
                <li><a href="../forum/forum.html" data-i18n="nav.articles">Articles</a></li>
                <li><a href="#" data-i18n="nav.contact">Contact</a></li>
                <button class="lang-toggle" id="languageToggle" aria-label="Changer de langue">üá´üá∑ FR</button>
                <button class="theme-toggle" id="themeToggle" aria-label="Changer de th√®me">
                    <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
                <button class="font-toggle" id="fontToggle" aria-label="Changer de police">Aa</button>
            </ul>
            <div class="menu-toggle" id="menuToggle">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
        </div>
    </nav>
    <!-- Side Menu -->
    <div class="side-menu" id="sideMenu">
        <ul class="side-nav-links">
            <li><a href="../index.html">Accueil</a></li>
            <li><a href="../index.html#apropos">√Ä propos</a></li>
            <li><a href="../formation/formation.html">Parcours et Experiences</a></li>
            <li><a href="../projets/projets.html">Projets</a></li>
            <li><a href="../forum/forum.html">Articles</a></li>
            <li><a href="#">Contact</a></li>
        </ul>
        <div class="side-menu-toggles">
            <button class="lang-toggle" id="languageToggleMobile" aria-label="Changer de langue">üá´üá∑ FR</button>
            <button class="theme-toggle" id="themeToggleMobile" aria-label="Changer de th√®me">
                <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
                <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
            <button class="font-toggle" id="fontToggleMobile" aria-label="Changer de police">Aa</button>
        </div>
    </div>
    <!-- Contact Section -->
    <section id="contact" class="contact-section">
        <div class="container">
            <h1 class="section-title" data-i18n="contact.title">Contactez-moi</h1>
            <p class="section-subtitle" data-i18n="contact.subtitle">Une question ? Un projet ? N'h√©sitez pas √† me contacter !</p>
            <div class="contact-grid">
                <!-- Formulaire de contact -->
                <div class="contact-form-container">
                    <h3 data-i18n="contact.form.title">üì® Envoyez-moi un message</h3>
                    <!-- Message de succ√®s/erreur -->
                    <div class="message success" id="successMessage" data-i18n="contact.form.success">
                        ‚úÖ Message envoy√© avec succ√®s ! Je vous r√©pondrai rapidement.
                    </div>
                    <div class="message error" id="errorMessage" data-i18n="contact.form.error">
                        ‚ùå Une erreur s'est produite. Veuillez r√©essayer.
                    </div>
                    <form id="contactForm">
                        <div class="form-group">
                            <label for="name" data-i18n="contact.form.name.label">Nom complet *</label>
                            <input type="text" id="name" name="name" placeholder="Votre nom" data-i18n-placeholder="contact.form.name.ph" required>
                        </div>
                        <div class="form-group">
                            <label for="email" data-i18n="contact.form.email.label">Email *</label>
                            <input type="email" id="email" name="email" placeholder="votre@email.com" data-i18n-placeholder="contact.form.email.ph" required>
                        </div>
                        <div class="form-group">
                            <label for="subject" data-i18n="contact.form.subject.label">Sujet *</label>
                            <input type="text" id="subject" name="subject" placeholder="Sujet de votre message" data-i18n-placeholder="contact.form.subject.ph" required>
                        </div>
                        <div class="form-group">
                            <label for="message" data-i18n="contact.form.message.label">Message *</label>
                            <textarea id="message" name="message" placeholder="Votre message..." data-i18n-placeholder="contact.form.message.ph" required></textarea>
                        </div>

                        <!-- Honeypot (anti-bot invisible) -->
                        <div style="display:none;">
                            <input type="text" name="honeypot" id="honeypot" tabindex="-1" autocomplete="off">
                        </div>

                        <!-- reCAPTCHA v2 Checkbox -->
                        <div class="g-recaptcha" data-sitekey="6Lc5sy8sAAAAAAXVtrcMYWXXPMXYChJ6EQOxykxe"></div>
                        <br>

                        <button type="submit" class="submit-btn" id="submitBtn" data-i18n="contact.form.submit">
                            <span>Envoyer le message</span>
                            <span>‚úâÔ∏è</span>
                        </button>
                    </form>
                </div>
                <!-- Informations de contact -->
                <div class="contact-info-container">
                    <!-- Coordonn√©es -->
                    <div class="contact-info-card">
                        <h4 data-i18n="contact.info.title">üìû Mes coordonn√©es</h4>
                        <div class="contact-item">
                            <div class="contact-icon">üìß</div>
                            <div class="contact-item-content">
                                <div class="contact-item-label" data-i18n="contact.info.email">Email</div>
                                <div class="contact-item-value">
                                    <a href="mailto:benbenjamin3005@gmail.com">benbenjamin3005@gmail.com</a>
                                </div>
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-icon">üì±</div>
                            <div class="contact-item-content">
                                <div class="contact-item-label" data-i18n="contact.info.phone">T√©l√©phone</div>
                                <div class="contact-item-value">
                                    <a href="tel:+33766739614">+33 7 66 73 96 14</a>
                                </div>
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-icon">üìç</div>
                            <div class="contact-item-content">
                                <div class="contact-item-label" data-i18n="contact.info.location">Localisation</div>
                                <div class="contact-item-value" data-i18n="contact.info.location.value">Auberchicourt, Nord</div>
                            </div>
                        </div>
                    </div>
                    <!-- R√©seaux sociaux -->
                    <div class="contact-info-card">
                        <h4 data-i18n="contact.social.title">üåê R√©seaux sociaux</h4>
                        <div class="social-links">
                            <a href="https://www.linkedin.com/in/benjamin-blondiaux-948894317" target="_blank" class="social-btn">
                                <span>üíº</span>
                                <span>LinkedIn</span>
                            </a>
                            <a href="https://github.com/BENJGabber" target="_blank" class="social-btn">
                                <span>üíª</span>
                                <span>GitHub</span>
                            </a>
                        </div>
                    </div>
                    <!-- T√©l√©charger CV -->
                    <div class="download-cv">
                        <h4 data-i18n="contact.cv.title">üìÑ Mon CV</h4>
                        <p data-i18n="contact.cv.desc">T√©l√©chargez mon CV complet au format PDF</p>
                        <a href="./CV.pdf" class="cv-btn" download>
                            <span>‚¨áÔ∏è</span>
                            <span data-i18n="contact.cv.button">T√©l√©charger mon CV</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        (function() {
            emailjs.init({
                publicKey: 't107x92N4c4V7GGX0',
                // Rate limit client-side : max 1 envoi toutes les 15 secondes
                limitRate: {
                    throttle: 15000 // 15000 ms = 15 secondes
                }
            });
        })();

        const contactForm = document.getElementById('contactForm');
        const submitBtn = document.getElementById('submitBtn');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');

        const EMAIL_SERVICE_ID = 'service_7n8wk97';
        const TEMPLATE_RECEPTION_ID = 'template_lpd0e4d';
        const TEMPLATE_AUTOREPLY_ID = 'template_44urjvt';

        contactForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Honeypot check
            if (document.getElementById('honeypot').value !== '') {
                errorMessage.textContent = "Spam d√©tect√©. Va te faire voir.";
                errorMessage.classList.add('show');
                setTimeout(() => errorMessage.classList.remove('show'), 5000);
                return;
            }

            // reCAPTCHA check
            const recaptchaResponse = grecaptcha.getResponse();
            if (recaptchaResponse.length === 0) {
                errorMessage.textContent = "Coche la case ¬´ Je ne suis pas un robot ¬ª, connard.";
                errorMessage.classList.add('show');
                setTimeout(() => errorMessage.classList.remove('show'), 5000);
                return;
            }

            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span>Envoi en cours...</span><span>‚è≥</span>';
            successMessage.classList.remove('show');
            errorMessage.classList.remove('show');

            const formData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                title: document.getElementById('subject').value,
                message: document.getElementById('message').value,
                'g-recaptcha-response': recaptchaResponse
            };

            try {
                // 1. Message re√ßu par toi
                await emailjs.send(EMAIL_SERVICE_ID, TEMPLATE_RECEPTION_ID, {
                    ...formData
                });

                // 2. Auto-reply √† l'exp√©diteur
                await emailjs.send(EMAIL_SERVICE_ID, TEMPLATE_AUTOREPLY_ID, {
                    name: formData.name,
                    email: formData.email,
                    title: formData.title,
                    message: formData.message
                });

                successMessage.classList.add('show');
                contactForm.reset();
                grecaptcha.reset(); // Reset CAPTCHA
                setTimeout(() => successMessage.classList.remove('show'), 5000);
            } catch (error) {
                console.error('Erreur EmailJS:', error);
                if (error.text && error.text.includes('rate limit')) {
                    errorMessage.textContent = "Trop rapide, attends un peu avant de r√©essayer.";
                } else {
                    errorMessage.textContent = "√âchec de l'envoi. R√©essaie.";
                }
                errorMessage.classList.add('show');
                setTimeout(() => errorMessage.classList.remove('show'), 5000);
                grecaptcha.reset();
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<span>Envoyer le message</span><span>‚úâÔ∏è</span>';
            }
        });
    </script>
    <!-- Bouton Retour en haut -->
    <button id="backToTop" class="back-to-top" data-i18n-aria="back.toTop" aria-label="Retour en haut">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="18 15 12 9 6 15"></polyline>
        </svg>
        <span class="sr-only" data-i18n="back.toTop">Retour en haut</span>
    </button>
    <script src="../script.js"></script>
</body>
</html>
